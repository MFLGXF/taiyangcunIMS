<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>会员卡优惠管理</title>
   <meta name="description" content="mobile first, app, web app, responsive, admin dashboard, flat, flat ui">	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">	<link rel="stylesheet" href="css/bootstrap.css">  <link rel="stylesheet" href="css/font-awesome.min.css">	<link rel="stylesheet" href="css/style.css">  <link rel="stylesheet" href="css/plugin.css">  <link rel="stylesheet" href="css/landing.css">  <link rel="stylesheet" href="css/b.page.bootstrap3.css" />  <link rel="stylesheet" href="css/b.page.css" />  <link rel="stylesheet" href="css/sweetalert2.css" />  <link rel="stylesheet" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css" /> <!--  <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.css"/> -->  <link rel="stylesheet" href="dist/css/formValidation.css"/>	<link rel="stylesheet" type="text/css" href="css/default.css">
<style type="text/css">.table-btn{	height:50%;	margin:3px 5px;	padding:5px 5px;}</style>
</head>
<body>
  <!-- header -->
	<header id="header" class="navbar">
    <ul class="nav navbar-nav navbar-avatar pull-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          <span class="hidden-sm-only">冯秀文</span>
          <span class="thumb-small avatar inline"><img src="images/avatar.jpg" alt="Mika Sokeil" class="img-circle"></span>
          <b class="caret hidden-sm-only"></b>
        </a>
        <ul class="dropdown-menu">
         <!--  <li><a href="#">Settings</a></li> -->
          <li><a href="#">Profile</a></li>
          <li><a href="#"><span class="badge bg-danger pull-right">3</span>Notifications</a></li>
          <li class="divider"></li>
          <li><a href="docs.html">Help</a></li>
          <li><a href="signin.html">Logout</a></li>
        </ul>
      </li>
    </ul>
    <a class="navbar-brand" href="#">随身拍</a>
    <button type="button" class="btn btn-link pull-left nav-toggle hidden-lg" data-toggle="class:slide-nav slide-nav-left" data-target="body">
      <i class="icon-reorder icon-xlarge text-default"></i>
    </button>
    <ul class="nav navbar-nav hidden-sm">


      <li class="dropdown shift" data-toggle="shift:appendTo" data-target=".nav-primary .nav">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-cog icon-xlarge visible-sm visible-sm-inline"></i>设置 <b class="caret hidden-sm-only"></b></a>
        <ul class="dropdown-menu">
          <li>
            <a href="#" data-toggle="class:navbar-fixed" data-target='body'>工具栏
              <span class="text-active">自定义</span>
              <span class="text">固定</span>
            </a>
          </li>
          <li class="visible-lg">
            <a href="#" data-toggle="class:nav-vertical" data-target="#nav">工具栏
              <span class="text-active">垂直</span>
              <span class="text">水平</span>
            </a>
          </li>
          <li class="divider hidden-sm"></li>

          <li>
            <a href="#" data-toggle="class:bg bg-black" data-target='.navbar'>工具横栏
              <span class="text-active">白色</span>
              <span class="text">暗色</span>
            </a>
          </li>
          <li>
            <a href="#" data-toggle="class:bg-light" data-target='#nav'>工具竖栏
              <span class="text-active">暗色</span>
              <span class="text">白色</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <form class="navbar-form pull-left shift" action="" data-toggle="shift:appendTo" data-target=".nav-primary">
      <i class="icon-search text-muted"></i>
      <input type="text" class="input-small form-control" placeholder="Search">
    </form>
	</header>
  <!-- / header -->
  <!-- nav -->
  <nav id="nav" class="nav-primary visible-lg nav-vertical">
        <ul class="nav" data-spy="affix" data-offset-top="50">      <li class="active"><a href="home.html"><i class="icon-dashboard icon-xlarge"></i>主页</a></li>   <li class="dropdown-submenu">        <a href="#"><i class="icon-instagram icon-xlarge"></i>摄影管理</a>        <ul class="dropdown-menu">          <li><a href="photo1.html">添加照片</a></li>          <li><a href="photo.html">浏览照片</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-list icon-xlarge"></i>基础资料管理</a>        <ul class="dropdown-menu"> 		  <li><a href="indexuser.html">添加基础资料</a></li>          <li><a href="selcustomer.html">客户信息列表</a></li>          <li><a href="selworker.html">员工信息列表</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-edit icon-xlarge"></i>会员管理</a>        <ul class="dropdown-menu">          <li><a href="member2.html">卡档案管理</a></li>          <li><a href="memberDiscount.html">优惠方案</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-facetime-video icon-xlarge"></i>设备管理</a>        <ul class="dropdown-menu"> 		  <li><a href="indexdevice.html">下载模板</a></li>          <li><a href="seldevice.html">拍照设备管理</a></li>          <li><a href="selclothes.html">服装管理</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-signal icon-xlarge"></i>产品及套系管理</a>        <ul class="dropdown-menu">          <li><a href="productCategory.html">产品类别设置</a></li>          <li><a href="product.html">产品设置</a></li>          <li><a href="economy.html">套系设置</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-signal icon-xlarge"></i>财务信息管理</a>        <ul class="dropdown-menu">          <li><a href="performance.html">业绩管理</a></li>          <li><a href="BalanceAndPayment.html">费用管理</a></li>        </ul>      </li>    </ul>
  </nav>
  <!-- / nav -->
  <section id="content" >
<section class="panel">        	<a type="button" data-toggle="modal" data-backdrop="static" href="#modal"  class="btn btn-info">添加</a>			<form class="form-inline" style="float:right;"  role="form">				<div class="col-lg-9">				    <input type="text" id="searchDisName" class="form-control"  placeholder="请输入会员卡类型查询">				    </div>				   	<button type="button" onclick="searchData();"  class="btn btn-info">查询</button>			</form>			</section>			<section class="panel">  				<table id="dataGridTableJson" class="table table-striped table-bordered table-striped with-check table-hover table-condensed">              <thead>                <tr>                  <th>类型</th>                  <th>折扣</th>                  <th>会员等级</th>                  <th>优惠方案</th>                  <th>最低额度</th>                  <th>操作</th>                </tr>              </thead>              <tbody>              </tbody>            </table>			<div id="page3"></div>          </section>
  </section>
  <div id="modal" class="modal fade">      <div class="modal-dialog pos-abt" style="margin-top:-235px; top:50%">        <div class="modal-content">          <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>            <h4 class="modal-title" id="myModalLabel">添加会员卡优惠信息</h4>          </div>          <div class="modal-body">          <div class="row">	            <div class="col-sm-10 col-sm-offset-2">	                <!-- <div class="page-header">	                    <h2>Bootstrap Form</h2>	                </div> -->	                <form id="defaultForm" method="post" class="form-horizontal" action="member/add"> 					<div class="form-group">		                <label class="col-lg-3 control-label">卡类型名称</label>		                <div class="col-lg-9">		                  <input type="text" name="cardTypeName" placeholder="会员卡类型名称" class="form-control" >							<!-- <div class="line line-dashed m-t-large"></div> -->		                </div>	              </div>	              <div class="form-group">	                <label class="col-lg-3 control-label">优惠折扣</label>                <div class="col-lg-9">                  <input type="number" name="discount" placeholder="请输入优惠折扣" class="form-control" >	                </div>	              </div>              <div class="form-group">                <label class="col-lg-3 control-label">优惠方案</label>                <div class="col-lg-9">                  <textarea  name="discription" placeholder="请输入优惠方案" class="bg-focus form-control"></textarea>                  <div class="line line-dashed m-t-large"></div>                </div>              </div>              <div class="form-group">                <label class="col-lg-3 control-label">会员卡等级</label>                <div class="col-lg-4">                  <select name="level" class="form-control">                    <option value="1">银卡</option>                    <option value="0">金卡</option>                  </select>                  <div class="line line-dashed m-t-large"></div>                </div>              </div>	                    <div class="form-group">			                <div class="col-lg-12 col-offset-3">			                  <button  data-dismiss="modal"  class="btn btn-white">取消</button>			                  <button type="submit" class="btn btn-primary">添加</button>			                </div>			              </div>	                </form>	            </div>	        </div>          </div>        </div><!-- /.modal-content -->      </div>  </div>
  <!-- / .modal -->
  <!-- footer -->
  <footer id="footer">    <div class="text-center padder clearfix">      <p>        <small>&copy; 随身拍 2018 | 东北林业大学  | 冯文秀</small><br><br>      </p>    </div>  </footer>
  <a href="#" class="hide slide-nav-block" data-toggle="class:slide-nav slide-nav-left" data-target="body"></a>
  <!-- / footer -->	<script src="js/jquery.min.js"></script>  <!-- Bootstrap -->  <script src="js/bootstrap.js"></script>  <script src="js/parsley/parsley.js"></script>  <!-- app --> <script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>    <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>    <script type="text/javascript" src="dist/js/formValidation.js"></script>    <script type="text/javascript" src="dist/js/framework/bootstrap.js"></script>    <script type="text/javascript" src="dist/js/language/zh_CN.js"></script>      <script src="js/sweetalert2.min.js"></script>  <script src="js/ie/excanvas.js"></script>  <script src="js/b.page.js"></script> <script type="text/javascript">  $(function(){		/*		*	在页面加载的时候取数据		*/		loadTableData();	});	function loadTableData(){		//每次方法执行之前把全局变量清空		dataObj = [];		$('#page3').bPage({			url:'memberdiscount/datagrid',		    //开启异步处理模式		    asyncLoad : true,		    //关闭服务端页面模式		    serverSidePage : false,		    //数据自定义填充		    render : function(data){		    	var result = data.data;				//alert("执行到这里了！");				console.log(data);		        var tb = $('#dataGridTableJson tbody');		        $(tb).empty();		        if(result && result.list && result.list.length > 0){		            $.each(result.list,function(i,row){		            	var singleData = row;		            	//alert(singleData);		            	var lowMoney = 50;		            	if(parseInt(singleData.level) == 1){		            		lowMoney = 100;		            	}						var trData = "<tr class='gradeA' id='"+singleData.id+"'>"+														"<td>"+singleData.cardTypeName+"</td>"+														"<td>"+singleData.discount+"&nbsp;折</td>"+														"<td>"+singleData.level+"&nbsp;折</td>"+														"<td>"+singleData.discription+"</td>"+														"<td>"+lowMoney+"&nbsp;元</td>"+														"<td>"+	                  									"<a class='btn table-btn' onclick=deleteMemberDiscount(\'"+singleData.id+"\'); >删除</a>"+		                  								"</td></tr>";			                /*这边需要记住的一个问题是，在onclick中传字符串是可以的，但是传递object对象就会出现错误*/		                $(tb).append(trData);		                dataObj.push(singleData);						});			        }			    },		    params : function(){				var doctorName = $("#searchDisName").val();		    	//alert("assetNo="+assetNumber+",person="+assetPersonId+",assetStatus="+assetStatus);		        return {		        	cardTypeName : doctorName		        };		    }		});	}	$(document).ready(function() {	    $('#defaultForm').formValidation({	        message: 'This value is not valid',	        icon: {	            valid: 'glyphicon glyphicon-ok',	            invalid: 'glyphicon glyphicon-remove',	            validating: 'glyphicon glyphicon-refresh'	        },	        fields: {	            cardTypeName: {	                message: '卡类型名称不合法',	                validators: {	                    notEmpty: {	                        message: '卡类型名称必须设置'	                    },	                    stringLength: {	                        min: 2,	                        max: 30,	                        message: '卡类型名称必须在2-30个字符之间'	                    },	                    regexp: {	                        regexp: /^[\u4e00-\u9fa5|0-9A-z]+$/,	                        message: '卡类型名称必须由字母、汉字、数字和下划线组成'	                    }	                }	            },	            discount: {	                validators: {	                    notEmpty: {	                        message: '优惠折扣不能为空'	                    },	                    regexp: {	                        regexp: /^[1-9]{1}[0-9]{14}$|^[1-9]{1}[0-9]{16}([0-9]|[xX])$/,	                        message: '优惠折扣格式错误'	                    }	                }	            },	            discription: {	                validators: {	                    notEmpty: {	                        message: '优惠方案不能为空'	                    }	                }	            }	        }	    }).on('success.form.fv', function(e) {            // Prevent submit form            e.preventDefault();            var $form     = $(e.target),                validator = $form.data('formValidation');            $.post($form.attr('action'), $form.serialize(), function(result) {                console.log(result);                var ret = result.result;                if(parseInt(ret) == 200){                	$("#modal").modal("hide");                	$(".modal-backdrop").hide();	                /*添加成功之后需要将数据回显到数据表格中*/                	loadTableData();	                $('.bPageRight:first').remove();                }else{                	swal("会员折扣方案数据添加错误！");                }            }, 'json');	    });	});	/*删除数据*/	function deleteMemberDiscount(areaId){		alert("areaId="+areaId);		swal({			  title: "确定删除吗？",			  text: "你将无法恢复该数据！",			  type: "warning",			  showCancelButton: true,			  confirmButtonColor: "#DD6B55",			  cancelButtonText: "取消删除！",			  confirmButtonText: "确定删除！",			  closeOnConfirm: false,			  closeOnCancel: false			}).then(function(isConfirm){				if (isConfirm) {					var idData = {};					idData.id = areaId;					/*首先需要查询该方案下有没有会员存在，如果存在的话就不能删除*/					$.ajax({						url:'member/listByDiscountId',						type:'GET',						data:idData,						dataType:'json',						success:function(data){							if(parseInt(data.result) == 200){								$.ajax({									url:'memberdiscount/delete',									type:'GET',									data:idData,									dataType:'json',									success:function(data){										swal('提示','该数据已被成功删除','success').then(function(isConfirm){											$("#"+areaId).remove();											$('.bPageRight:first').remove();											loadTableData();										});									},									error:function(){										swal('提示','删除数据时出错','error');									}								});							}else{							}							swal('提示','该优惠方案下还有会员卡绑定，不能删除','success').then(function(isConfirm){							});						},						error:function(){							swal('提示','删除数据时出错','error');						}					});				  } else {				    //swal("取消！", "已经取消的删除","error");				  }			});	}	function searchData(){		$('.bPageRight:first').remove();		loadTableData();	}  </script>

</body>
</html>