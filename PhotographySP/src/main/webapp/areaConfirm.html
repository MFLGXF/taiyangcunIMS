<!DOCTYPE html>
<html lang="en">
<head>
<title>土地确权</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="css/uniform.css" />
<link rel="stylesheet" href="css/select2.css" />
<link rel="stylesheet" href="css/matrix-style2.css" />
<link rel="stylesheet" href="css/matrix-media.css" />
<link rel="stylesheet" href="css/sweetalert2.min.css" />
<link rel="stylesheet" href="css/b.page.bootstrap3.css" />
<link rel="stylesheet" href="css/b.page.css" />
<link href="font-awesome/css/font-awesome.css" rel="stylesheet" />
</head>
<body>

<div id="content">
  <div id="content-header">
      <h1>土地权属信息</h1>
  </div>

  <div class="widget-box">

        <div class="widget-content">

  <form class="form-inline" role="form">
  <div class="form-group">
    <label class="sr-only" for="name">地址</label>
    <input type="text" class="form-control" id="areaKey" placeholder="请输入地址关键字">

   				<select style="width:150px;" name="personId" id="selectAreaPerson">
                 	<option value="" selected>--权利行使人--</option>
                </select>

                <select style="width:150px;" name="rentPersonId" id="selectAreaRentPerson">
                 	<option value="" selected>--承包人--</option>
                </select>

				<select style="width:150px;" name="areaConfirm" id="selectAreaType">
                  	<option value="0">--是否确权--</option>
                  	<option value="1">已确权</option>
                  	<option value="2">未确权</option>
                </select>

                <select style="width:150px;" name="areaRent" id="selectAreaRentType">
                  	<option value="0">--是否承包--</option>
                  	<option value="1">已承包</option>
                  	<option value="2">未承包</option>
                </select>

    		<button type="button" onclick="searchAreaData();"  class="btn btn-info">查询</button>

  </div>
</form>
</div>
</div>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"><i class="icon-th"></i></span>
            <h5>土地权属信息</h5>
          </div>
          <!-- <div class="widget-content nopadding">
            <table class="table table-bordered data-table"> -->
             <div class="table-responsive">
  				<table id="dataGridTableJson" class="table table-striped table-bordered table-hover table-condensed">
              <thead>
                <tr>
                  <th>地址</th>
                  <th>类型</th>
                  <th>面积</th>
                  <th>是否确权</th>
                  <th>权利行使人</th>
                  <th>是否承包</th>
                  <th>承包人</th>
                  <th>创建时间</th>
                  <th>修改时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>


              </tbody>
            </table>
          </div>
			<div id="page3"></div>
        </div>

      </div>
    </div>
  </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/jquery.ui.custom.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.uniform.js"></script>
<script src="js/select2.min.js"></script>
<script src="js/jquery.dataTables.min.js"></script>
<script src="js/matrix.js"></script>
<script src="js/matrix.tables.js"></script>
<script src="js/sweetalert2.min.js"></script>
 <script src="js/b.page.js"></script>

<script type="text/javascript">

	//这边弄一个全局的对象数组存储表格数据
	var dataObj = [];
	$(function(){

		/*
		*	在页面加载的时候取数据
		*/
		loadTableData();


		var selectAreaPerson = $("#selectAreaPerson");
		var selectAreaRentPerson = $("#selectAreaRentPerson");
		//向后台发送get请求，接收用户数据
		$.get("user/userMessage",{},function(data){
			//然后将人员数据导入到下拉列表中
			var result = data.data;
			//alert(result);
			for(var i = 0;i < result.length; i++){
				//var option = $("<option>"+result[i].name+"</option>");
				selectAreaPerson.append($("<option value='"+result[i].id+"'>"+result[i].name+"</option>"));
				selectAreaRentPerson.append($("<option value='"+result[i].id+"'>"+result[i].name+"</option>"));
			}
		});

	});

	function loadTableData(){
		//每次方法执行之前把全局变量清空
		dataObj = [];

		$('#page3').bPage({
			url:'area/datagrid2',
		    //开启异步处理模式
		    asyncLoad : true,
		    //关闭服务端页面模式
		    serverSidePage : false,
		    //数据自定义填充
		    render : function(data){
		    	var result = data.data;

		        var tb = $('#dataGridTableJson tbody');
		        $(tb).empty();
		        if(result && result.list && result.list.length > 0){
		            $.each(result.list,function(i,row){
		            	var singleData = row;

						/*判断土地类型*/
						var areaTypeName = "耕地";
						var areaSize = singleData.areaLandSize+"(亩)";
						if(parseInt(singleData.areaType) == 2){
							areaTypeName = "宅基地";
							areaSize = singleData.areaHouseSize+"(平方米)";
						}
						/*判断是否确权*/
						var isconfirmed = "已确权";
						var personName = singleData.personName;
						if(parseInt(singleData.areaConfirm) == 2){
							isconfirmed = "未确权";
							personName = "--";
						}

						var areaRent = singleData.areaRent;
						var rentPerson = singleData.rentPersonName;
						if(areaRent != null){
							if(parseInt(areaRent) != 1){
								rentPerson = "--";
								areaRent = "未承包";
							}else{
								areaRent = "已承包";
							}
						}


						/*对创建时间和修改时间做处理*/
						var createTime = singleData.createTime;
						if(createTime != null){
							createTime = createTime.split(" ")[0];
						}

						var updateTime = singleData.updateTime;
						if(updateTime == null){
							updateTime = "--"
						}

						if(createTime != null){
							createTime = createTime.split(" ")[0];
						}

						if(updateTime != null){
							updateTime = updateTime.split(" ")[0];
						}

						//将json对象转化成字符串传出去
						stringJsonData = JSON.stringify(singleData);
						stringJsonData = stringJsonData.replace(/\"/g,"'");
						//swal(stringJsonData);
						console.log("\""+stringJsonData+"\"");
						/*判断是否已参保*/
						var trData = "<tr class='gradeA' id='"+singleData.id+"'><td>"+singleData.areaAddress+"</td>"+
														"<td>"+areaTypeName+"</td>"+
														"<td>"+areaSize+"</td>"+
														"<td>"+isconfirmed+"</td>"+
														"<td>"+personName+"</td>"+
														"<td>"+areaRent+"</td>"+
														"<td>"+rentPerson+"</td>"+
														"<td>"+createTime+"</td>"+
														"<td>"+updateTime+"</td>"+
														"<td>"+
		                  									"<a class='btn' href='#' onclick=updateArea(\'"+singleData.id+"\'); >修改</a>"+
		                  									"<a class='btn' onclick=deleteArea(\'"+singleData.id+"\'); >删除</a>"+
		                  								"</td></tr>";

			                /*这边需要记住的一个问题是，在onclick中传字符串是可以的，但是传递object对象就会出现错误*/
		                $(tb).append(trData);
		                dataObj.push(singleData);

						});
			        }
			    },
		    params : function(){
		    	var areaAddr = $("#areaKey").val();
				var personId = $("#selectAreaPerson").val();
				var rentPersonId = $("#selectAreaRentPerson").val();
				var areaConfirm = parseInt($("#selectAreaType").val());
				var areaRent = parseInt($("#selectAreaRentType").val());

		    	//alert("assetNo="+assetNumber+",person="+assetPersonId+",assetStatus="+assetStatus);


		        return {
		        	areaAddress : areaAddr,
		        	personId : personId,
		        	rentPersonId : rentPersonId,
		        	areaConfirm : areaConfirm,
		        	areaRent : areaRent
		        };
		    }
		});

	}


	/*删除土地数据*/
	function deleteArea(areaId){
		//alert("该方法触发,"+areaId);
		swal({
			  title: "确定删除吗？",
			  text: "你将无法恢复该数据！",
			  type: "warning",
			  showCancelButton: true,
			  confirmButtonColor: "#DD6B55",
			  cancelButtonText: "取消删除！",
			  confirmButtonText: "确定删除！",
			  closeOnConfirm: false,
			  closeOnCancel: false
			}).then(function(isConfirm){
				if (isConfirm) {
					var data = {};
					data.id = areaId;
					$.ajax({
						url:'area/deleteArea',
						type:'GET',
						data:data,
						dataType:'json',
						success:function(data){
							swal('提示','该数据已被成功删除','success').then(function(isConfirm){
								$("#"+areaId).remove();
								$('.bPageRight:first').remove();
								loadTableData();
							});
						},
						error:function(){
							swal('提示','删除数据时出错','error');
						}
					});
				  } else {
				    //swal("取消！", "已经取消的删除","error");
				  }
			});

	}

	function updateArea(areaData){
		//alert("更新数据代码执行："+areaData);
		var updateData = null;
		for(var i = 0; i < dataObj.length; i++){
			if(dataObj[i].id == areaData){
				updateData = dataObj[i];
			}
		}

		var areaStringData = JSON.stringify(updateData);
		//alert(JSON.stringify(updateData));

		window.location.href = "addArea.html?areaId="+updateData.id;

	}


	function searchAreaData(){
		alert("该方法执行了");
		$('.bPageRight:first').remove();
		loadTableData();
	}



</script>
</body>
</html>
