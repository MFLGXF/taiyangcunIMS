<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>套系设置</title>
  <meta name="description" content="mobile first, app, web app, responsive, admin dashboard, flat, flat ui">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/plugin.css">
  <link rel="stylesheet" href="css/landing.css">  <link rel="stylesheet" href="css/b.page.bootstrap3.css" />  <link rel="stylesheet" href="css/b.page.css" />  <link rel="stylesheet" href="css/sweetalert2.css" />  <link rel="stylesheet" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css" /> <!--  <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.css"/> -->  <link rel="stylesheet" href="dist/css/formValidation.css"/>	<link rel="stylesheet" type="text/css" href="css/default.css">

</head><style type="text/css">.table-btn{	height:50%;	margin:3px 5px;	padding:5px 5px;}</style>
<body>
  <!-- header -->
	<header id="header" class="navbar">
    <ul class="nav navbar-nav navbar-avatar pull-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          <span class="hidden-sm-only">Mika Sokeil</span>
          <span class="thumb-small avatar inline"><img src="images/avatar.jpg" alt="Mika Sokeil" class="img-circle"></span>
          <b class="caret hidden-sm-only"></b>
        </a>
        <ul class="dropdown-menu">
         <!--  <li><a href="#">Settings</a></li> -->
          <li><a href="#">Profile</a></li>
          <li><a href="#"><span class="badge bg-danger pull-right">3</span>Notifications</a></li>
          <li class="divider"></li>
          <li><a href="docs.html">Help</a></li>
          <li><a href="signin.html">Logout</a></li>
        </ul>
      </li>
    </ul>
    <a class="navbar-brand" href="#">随身拍</a>
    <button type="button" class="btn btn-link pull-left nav-toggle hidden-lg" data-toggle="class:slide-nav slide-nav-left" data-target="body">
      <i class="icon-reorder icon-xlarge text-default"></i>
    </button>
    <ul class="nav navbar-nav hidden-sm">

      <li><div class="m-t-small"><a class="btn btn-small btn-info" data-toggle="modal" href="#modal"><i class="icon-plus"></i> POST</a></div></li>
      <li class="dropdown shift" data-toggle="shift:appendTo" data-target=".nav-primary .nav">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-cog icon-xlarge visible-sm visible-sm-inline"></i>设置 <b class="caret hidden-sm-only"></b></a>
        <ul class="dropdown-menu">
          <li>
            <a href="#" data-toggle="class:navbar-fixed" data-target='body'>工具栏
              <span class="text-active">自定义</span>
              <span class="text">固定</span>
            </a>
          </li>
          <li class="visible-lg">
            <a href="#" data-toggle="class:nav-vertical" data-target="#nav">工具栏
              <span class="text-active">垂直</span>
              <span class="text">水平</span>
            </a>
          </li>
          <li class="divider hidden-sm"></li>

          <li>
            <a href="#" data-toggle="class:bg bg-black" data-target='.navbar'>工具横栏
              <span class="text-active">白色</span>
              <span class="text">暗色</span>
            </a>
          </li>
          <li>
            <a href="#" data-toggle="class:bg-light" data-target='#nav'>工具竖栏
              <span class="text-active">暗色</span>
              <span class="text">白色</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>

	</header>
  <!-- / header -->
  <!-- nav -->
  <nav id="nav" class="nav-primary visible-lg nav-vertical">
        <ul class="nav" data-spy="affix" data-offset-top="50">      <li class="active"><a href="home.html"><i class="icon-dashboard icon-xlarge"></i>主页</a></li>   <li class="dropdown-submenu">        <a href="#"><i class="icon-instagram icon-xlarge"></i>摄影管理</a>        <ul class="dropdown-menu">          <li><a href="photo1.html">添加照片</a></li>          <li><a href="photo.html">浏览照片</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-list icon-xlarge"></i>基础资料管理</a>        <ul class="dropdown-menu"> 		  <li><a href="indexuser.html">添加基础资料</a></li>          <li><a href="selcustomer.html">客户信息列表</a></li>          <li><a href="selworker.html">员工信息列表</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-edit icon-xlarge"></i>会员管理</a>        <ul class="dropdown-menu">          <li><a href="member2.html">卡档案管理</a></li>          <li><a href="memberDiscount.html">优惠方案</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-facetime-video icon-xlarge"></i>设备管理</a>        <ul class="dropdown-menu"> 		  <li><a href="indexdevice.html">下载模板</a></li>          <li><a href="seldevice.html">拍照设备管理</a></li>          <li><a href="selclothes.html">服装管理</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-signal icon-xlarge"></i>产品及套系管理</a>        <ul class="dropdown-menu">          <li><a href="productCategory.html">产品类别设置</a></li>          <li><a href="product.html">产品设置</a></li>          <li><a href="economy.html">套系设置</a></li>        </ul>      </li>      <li class="dropdown-submenu">        <a href="#"><i class="icon-signal icon-xlarge"></i>财务信息管理</a>        <ul class="dropdown-menu">          <li><a href="performance.html">业绩管理</a></li>          <li><a href="BalanceAndPayment.html">费用管理</a></li>        </ul>      </li>    </ul>
  </nav>
  <!-- / nav -->
 <div class="row"> <div class="col-lg-2"> </div>        <div class="col-lg-9">        <div class="alert alert-warning alert-block">            <button type="button" class="close" data-dismiss="alert"></button>            <h4><i></i>注意!</h4>            <p>最多能设置5个套系，默认套系不能被删除，套系不能被修改，只能删除后重新设置！！！</p>          </div>        <section class="panel">        	<a type="button" data-toggle="modal" data-backdrop="static" href="#modal"  class="btn btn-info">添加套系</a>			<form class="form-inline" style="float:right;"  role="form">				<div class="col-lg-9">				    <input type="text" id="searchDocName" class="form-control"  placeholder="请输入套系名称进行查询">				    </div>				   	<button type="button" onclick="searchAreaData();"  class="btn btn-info">查询</button>			</form>			</section><section class="panel">            <header class="panel-heading">              <span class="label bg-info pull-right">5</span>              套系产品设置信息            </header>            <section class="panel-content" id="panel-economy">            </section>          </section>          </div>          </div>
  <!-- .modal -->
  <div id="modal" class="modal fade">
      <div class="modal-dialog pos-abt" style="margin-top:-235px; top:50%">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
            <h4 class="modal-title" id="myModalLabel">添加套系信息</h4>
          </div>
          <div class="modal-body">	        <div class="row">	            <div class="col-sm-10 col-sm-offset-2">	                <!-- <div class="page-header">	                    <h2>Bootstrap Form</h2>	                </div> -->	                <form id="defaultForm" method="post" class="form-horizontal" action="economy/add"> 					<div class="form-group">		                <label class="col-lg-3 control-label">套系名称</label>		                <div class="col-lg-9">		                  <input type="text" name="eName" placeholder="套系名称" class="form-control" >							<!-- <div class="line line-dashed m-t-large"></div> -->		                </div>	              </div>	              <div class="form-group">	                <label class="col-lg-3 control-label">摄影师数量</label>	                <div class="col-lg-9">						<select class="form-control" name="ePhotographyer">		                	<option value="1">1</option>		                	<option value="2">2</option>	                	</select>						<!-- <textarea  name="discription" placeholder="请输入产品分类描述" class="bg-focus form-control"></textarea> -->	                </div>	              </div>	              <div class="form-group">	                <label class="col-lg-3 control-label">是否需要造型师</label>	                <div class="col-lg-9">						<select class="form-control" name="eModelling">		                	<option value="0">需要</option>		                	<option value="1">不需要</option>	                	</select>						<!-- <textarea  name="discription" placeholder="请输入产品分类描述" class="bg-focus form-control"></textarea> -->	                </div>	              </div>	              <div class="form-group">	                <label class="col-lg-3 control-label">取景方案</label>	                <div class="col-lg-9">						<select class="form-control" name="eLocation">		                	<option value="内景">内景</option>		                	<option value="外景">外景</option>		                	<option value="普通布景">普通布景</option>	                	</select>						<!-- <textarea  name="discription" placeholder="请输入产品分类描述" class="bg-focus form-control"></textarea> -->	                </div>	              </div>	              <div class="form-group">	                <label class="col-lg-3 control-label">套系描述</label>	                <div class="col-lg-9">						<textarea  name="eDiscription" placeholder="请输入套系描述" class="bg-focus form-control"></textarea>	                </div>	              </div>	                    <div class="form-group">			                <div class="col-lg-12 col-offset-3">			                  <button  data-dismiss="modal"  class="btn btn-white">取消</button>			                  <button type="submit" class="btn btn-primary">添加</button>			                </div>			              </div>	                </form>	            </div>	        </div>          </div>
        </div><!-- /.modal-content -->
      </div>
  </div>  <div id="mymodal" class="modal fade">      <div class="modal-dialog pos-abt" style="margin-top:-235px; top:50%">        <div class="modal-content">          <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>            <h4 class="modal-title" id="myModalLabel">配置套系产品信息</h4>          </div>          <div class="modal-body">			<!-- <section class="panel"> -->			<input type="hidden" id="hiddenId" value="">  				<table id="dataGridTableJson" class="table table-striped table-bordered table-striped with-check table-hover table-condensed">              <thead>                <tr>                <th><i class="icon-resize-vertical"></i></th>                  <th>产品名称</th>                  <th>所属分类</th>                </tr>              </thead>              <tbody>              </tbody>            </table>			<div id="page3"></div>          <!-- </section> -->			<button  data-dismiss="modal"  class="btn btn-white">取消</button>			<button onclick="addProduct()" class="btn btn-primary">添加</button>          </div>        </div><!-- /.modal-content -->      </div>  </div>
  <!-- / .modal -->
  <!-- footer -->
  <footer id="footer">    <div class="text-center padder clearfix">      <p>        <small>&copy; 随身拍 2018 | 东北林业大学  | 冯文秀</small><br><br>      </p>    </div>  </footer>
  <a href="#" class="hide slide-nav-block" data-toggle="class:slide-nav slide-nav-left" data-target="body"></a>
  <!-- / footer -->
	<script src="js/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="js/bootstrap.js"></script>  <script src="js/parsley/parsley.js"></script>
  <!-- app -->
 <script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>    <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>    <script type="text/javascript" src="dist/js/formValidation.js"></script>    <script type="text/javascript" src="dist/js/framework/bootstrap.js"></script>    <script type="text/javascript" src="dist/js/language/zh_CN.js"></script>      <script src="js/sweetalert2.min.js"></script>
  <script src="js/ie/excanvas.js"></script>  <script src="js/b.page.js"></script>  <script type="text/javascript">  $(function(){	  		/*		*	在页面加载的时候取数据		*/		loadTableData();		/**/		loadModalData();	});	function loadTableData(){		//每次方法执行之前把全局变量清空		dataObj = [];		/*这边需要向后端发送ajax请求，然后将数据回显到panel中*/		$.ajax({			url:'economy/datagrid',			type:'GET',			dataType:'json',			success:function(data){				var result = data.data;				var panel = $("#panel-economy");		    	console.log(result);		        $(panel).empty();		        if(result && result.list && result.list.length > 0){		            $.each(result.list,function(i,row){		            	var singleData = row;		            	console.log(row);		            	var emodel = "需要";		            	if(parseInt(singleData.eModelling) == 1){		            		emodel = "不需要";		            	}		            	var product = "请配置该套系下面的产品";		            	if(singleData.productIds != null){		            		product="该套系下面配置的产品有："+singleData.productIds;		            	}						var trData = "<article class='media'>"+                						"<div class='pull-left thumb-small'>"+                  							"<span class='icon-stack'>"+                    							"<i class=''></i>"+                  							"</span>"+                						"</div>"+                						"<div class='media-body'>"+                  							"<div class='pull-right media-mini text-center text-muted'>"+												"<a type='button' href='#' onclick=configProduct(\'"+singleData.id+"\');  class='btn btn-info'>配置产品</a>"+                    							"<button type='button' onclick=deleteEconomy(\'"+singleData.id+"\');  class='btn btn-info'>删除</button>"+                  							"</div>"+                  							"<a href='#' class='h4'>套系"+(i+1)+"--"+singleData.eName+"</a>"+                  							"<small class='block'>"+"该套系配置摄影师"+singleData.ePhotographyer+"名,"+emodel+"造型,取景方式为"+singleData.eLocation+"</small>"+                  							"<small class='block'>有关该套系的描述："+singleData.eDiscription+"</small>"+                  							"<small class='block'>"+product+"</small>"+                						"</div>"+              						"</article>"+             						 "<div class='line pull-in'></div>";		                $(panel).append(trData);		                dataObj.push(singleData);						});			        }			},			error:function(){				swal('提示','删除数据时出错','error');			}		});	}	$(document).ready(function() {	    $('#defaultForm').formValidation({	        message: 'This value is not valid',	        icon: {	            valid: 'glyphicon glyphicon-ok',	            invalid: 'glyphicon glyphicon-remove',	            validating: 'glyphicon glyphicon-refresh'	        },	        fields: {	            eName: {	                message: '套系名称不合法',	                validators: {	                    notEmpty: {	                        message: '套系名称必须设置'	                    },	                    stringLength: {	                        min: 2,	                        max: 30,	                        message: '套系名称必须在2-30个字符之间'	                    },	                    regexp: {	                        regexp: /^[\u4e00-\u9fa5|0-9A-z]+$/,	                        message: '套系名称必须由字母、汉字、数字和下划线组成'	                    }	                }	            },	            eDiscription: {	                message: '套系描述不合法',	                validators: {	                    notEmpty: {	                        message: '套系描述必须设置'	                    },	                    stringLength: {	                        min: 2,	                        max: 200,	                        message: '套系描述必须在2-30个字符之间'	                    },	                    regexp: {	                        regexp: /^[\u4e00-\u9fa5|0-9A-z]+$/,	                        message: '套系描述必须由字母、汉字、数字和下划线组成'	                    }	                }	            }	        }	    }).on('success.form.fv', function(e) {            // Prevent submit form            e.preventDefault();            var $form     = $(e.target),                validator = $form.data('formValidation');            $.post($form.attr('action'), $form.serialize(), function(result) {                console.log(result);                var ret = result.result;                if(parseInt(ret) == 200){                	$("#modal").modal("hide");                	$(".modal-backdrop").hide();	                /*添加成功之后需要将数据回显到数据表格中*/                	loadTableData();                	 window.location.href="economy.html";	                $('.bPageRight:first').remove();                }else{                	swal("套系名称已存在！");                }            }, 'json');	    });	});	/*删除数据*/	function deleteEconomy(areaId){		//alert("areaId="+areaId);		swal({			  title: "确定删除吗？",			  text: "该套系会被删除！",			  type: "warning",			  showCancelButton: true,			  confirmButtonColor: "#DD6B55",			  cancelButtonText: "取消删除！",			  confirmButtonText: "确定删除！",			  closeOnConfirm: false,			  closeOnCancel: false			}).then(function(isConfirm){				if (isConfirm) {					var data = {};					data.id = areaId;						$.ajax({							url:'economy/delete',							type:'GET',							data:data,							dataType:'json',							success:function(data){								swal('提示','该数据已被成功删除','success').then(function(isConfirm){									$("#"+areaId).remove();									loadTableData();								});							},							error:function(){								swal('提示','删除数据时出错','error');							}						});				  } else {				    //swal("取消！", "已经取消的删除","error");				  }			});	}	function configProduct(id){		//alert("你说呢");backdrop		$("#hiddenId").val("");		$("#mymodal").modal({			backdrop:"static"		});		$("#hiddenId").val(id);	}	function loadModalData(){		//每次方法执行之前把全局变量清空		dataObj = [];		$('#page3').bPage({			url:'product/datagrid',		    //开启异步处理模式		    asyncLoad : true,		    //关闭服务端页面模式		    serverSidePage : false,		    //数据自定义填充		    render : function(data){		    	var result = data.data;		    	console.log(result);		        var tb = $('#dataGridTableJson tbody');		        $(tb).empty();		        if(result && result.list && result.list.length > 0){		            $.each(result.list,function(i,row){		            	var singleData = row;						var trData = "<tr class='gradeA' id='"+singleData.id+"'>"+														"<td><input type='checkbox' name='deleteCheckbox' id='"+singleData.pName+"'/></td>"+														"<td>"+singleData.pName+"</td>"+														"<td>"+singleData.pCategory+"</td>"+														"</tr>";			                /*这边需要记住的一个问题是，在onclick中传字符串是可以的，但是传递object对象就会出现错误*/		                $(tb).append(trData);		                dataObj.push(singleData);						});			        }			    },		    params : function(){				var doctorName = $("#searchDocName").val();		    	//alert("assetNo="+assetNumber+",person="+assetPersonId+",assetStatus="+assetStatus);		        return {		        	pcName : doctorName		        };		    }		});	}	/*对套系关联的产品进行添加*/	function addProduct(){		var checkIds = $('input:checkbox[name=deleteCheckbox]:checked');		if(checkIds.length <= 0){      		swal('提示','请选择要删除的数据','error');      		return false;      	}		var ids = "";		var deleteIds=[];      	//alert("您选中了："+checkIds.length+"调数据");      	ids = checkIds[0].id;      	deleteIds.push(ids);      	for(var i = 1; i < checkIds.length;i++){      		//alert("获取到了id的值："+checkIds[i].id);      		ids = ids + ","+checkIds[i].id;      		deleteIds.push(checkIds[i].id);      	}		//alert("发送的数据：ids="+ids);      	/*最后是发送ajax请求删除数据*/      	var eId = $("#hiddenId").val();		$.ajax({      		url:"economy/update?ids="+ids+"&eId="+eId,      		type:"GET",      		dataType:"json",      		success:function(data){      			window.location.href="economy.html";			},			error:function(){				swal('提示','修改数据时出错','error');				deleteIds = [];			}      	});	}  </script>
</body>
</html>